<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prenota il Tuo Test Drive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning
        tailwind.config = {
            theme: {
                extend: {}
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1412 30%, #2d1810 60%, #0a0a0a 100%);
            min-height: 100vh;
            color: #f5f5f0;
        }
        
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #d4af37 0%, #f4e4c1 30%, #c9a02c 60%, #e5c87f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: shimmer 3s linear infinite;
        }
        
        @keyframes shimmer {
            to {
                background-position: 200% center;
            }
        }
        
        .glass-card {
            background: rgba(20, 15, 12, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            border-radius: 24px;
            transition: all 0.4s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .glass-card:hover {
            border-color: rgba(212, 175, 55, 0.4);
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(212, 175, 55, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #d4af37 0%, #c9a02c 50%, #b8941f 100%);
            color: #0a0a0a;
            font-weight: 600;
            padding: 18px 40px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.5);
            background: linear-gradient(135deg, #e5c047 0%, #d4af37 50%, #c9a02c 100%);
        }
        
        .btn-secondary {
            background: rgba(212, 175, 55, 0.08);
            color: #d4af37;
            border: 1.5px solid #d4af37;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-secondary:hover {
            background: rgba(212, 175, 55, 0.18);
            transform: translateX(-4px);
        }
        
        .distance-option {
            padding: 24px;
            border: 2px solid rgba(80, 60, 45, 0.4);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(10, 10, 10, 0.6);
        }
        
        .distance-option:hover {
            border-color: rgba(212, 175, 55, 0.6);
            transform: scale(1.03);
            background: rgba(45, 24, 16, 0.4);
        }
        
        .distance-option.selected {
            border-color: #d4af37;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(201, 160, 44, 0.08));
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.2);
        }
        
        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            font-size: 14px;
            color: #86efac;
        }
        
        /* increased left padding for better placeholder spacing */
        input, select, textarea {
            background: rgba(10, 10, 10, 0.9);
            border: 1.5px solid rgba(80, 60, 45, 0.4);
            color: #f5f5f0;
            padding: 16px 100px;
            padding-left: 100px; /* <-- moved placeholders a bit to the right */
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        /* fix select right padding to keep dropdown icon visible */
        select {
            padding-right: 45px;
        }
        
        input::placeholder, textarea::placeholder {
            color: rgba(165, 145, 115, 0.5);
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.12);
            background: rgba(20, 15, 12, 0.95);
        }
        
        .hero-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 24px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid rgba(80, 60, 45, 0.25);
        }
        
        .spec-item:last-child {
            border-bottom: none;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fade-in {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 18px;
            background: rgba(10, 10, 10, 0.6);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(80, 60, 45, 0.2);
        }
        
        .checkbox-container:hover {
            background: rgba(212, 175, 55, 0.06);
            border-color: rgba(212, 175, 55, 0.3);
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #d4af37;
        }
        
        /* removed sticky from single summary and made sidebar sticky */
        /* .price-summary { position: sticky; top: 20px; } */ 

        .sidebar {
            position: sticky;
            top: 20px;
            align-self: start; /* keeps sidebar aligned at top of grid column */
        }
        
        .policies-card {
            position: relative;
        }
        
        /* Custom Date Picker Styles */
        .date-picker-container {
            position: relative;
        }
        
        .date-picker-input {
            cursor: pointer;
            position: relative;
        }
        
        .date-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #f5f5f0;
            pointer-events: none;
        }
        
        .custom-calendar {
            position: absolute; /* will be positioned via JS relative to body */
            margin-top: 8px;
            background: linear-gradient(135deg, rgba(20, 15, 12, 0.98), rgba(30, 20, 15, 0.98));
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            padding: 20px;
            z-index: 99999; /* very high so it overlays everything */
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: #d4af37;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .calendar-nav:hover {
            background: rgba(212, 175, 55, 0.2);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 8px;
            color: #d4af37;
            font-weight: 600;
            font-size: 12px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(20, 15, 12, 0.6);
            border: 1px solid rgba(80, 60, 45, 0.3);
        }
        
        .calendar-day:hover:not(.disabled):not(.empty) {
            background: rgba(212, 175, 55, 0.2);
            border-color: #d4af37;
        }
        
        .calendar-day.selected {
            background: linear-gradient(135deg, #d4af37, #c9a02c);
            color: #0a0a0a;
            font-weight: 700;
        }
        
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        
        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23f5f5f0' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            /* padding-right set above */
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-12 animate-fade-in">
            <div class="flex items-center justify-between mb-6">
                <button onclick="window.history.back()" class="btn-secondary">
                    ← Indietro
                </button>
                <div class="text-right">
                    <div class="text-sm" style="color: #d4af37;">Esperienza Esclusiva</div>
                </div>
            </div>
            <h1 class="text-5xl md:text-6xl font-bold gradient-text mb-4">Prenota il Tuo Test Drive</h1>
            <p class="text-xl" style="color: #c9a891;">Un'esperienza indimenticabile ti aspetta</p>
        </header>

        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Car Hero Section -->
                <div class="glass-card p-8 animate-fade-in">
                    <img src="https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=1200&h=500&fit=crop" alt="Ferrari SF90" class="hero-image mb-6">
                    
                    <div class="flex items-start justify-between mb-6">
                        <div>
                            <h2 class="text-4xl font-bold mb-2">Ferrari SF90 Stradale</h2>
                            <div class="flex items-center gap-2" style="color: #c9a891;">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                Milano, Italia
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold gradient-text">€890</div>
                            <div class="text-sm" style="color: #a59173;">da / esperienza</div>
                        </div>
                    </div>

                    <!-- Features -->
                    <div class="flex flex-wrap gap-3 mb-6">
                        <span class="feature-badge">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Assicurazione Inclusa
                        </span>
                        <span class="feature-badge">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Nessuna Cauzione
                        </span>
                        <span class="feature-badge">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                            Cambio Data Gratuito
                        </span>
                    </div>

                    <p style="color: #c9a891;" class="leading-relaxed mb-6">
                        La SF90 Stradale rappresenta l'apice dell'innovazione Ferrari, combinando un motore V8 biturbo da 780 CV con tre motori elettrici per una potenza totale di 1000 CV. Un capolavoro di ingegneria che ridefinisce il concetto di supercar ibrida.
                    </p>

                    <!-- Technical Specs -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold mb-4 gradient-text">Prestazioni</h3>
                            <div class="space-y-2">
                                <div class="spec-item">
                                    <span style="color: #a59173;">Potenza</span>
                                    <span class="font-semibold">1000 CV</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">0-100 km/h</span>
                                    <span class="font-semibold">2.5 secondi</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">Velocità Massima</span>
                                    <span class="font-semibold">340 km/h</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">Trazione</span>
                                    <span class="font-semibold">4WD</span>
                                </div>
                            </div>
                        </div>

                        <div class="glass-card p-6">
                            <h3 class="text-xl font-bold mb-4 gradient-text">Caratteristiche</h3>
                            <div class="space-y-2">
                                <div class="spec-item">
                                    <span style="color: #a59173;">Motore</span>
                                    <span class="font-semibold">V8 Biturbo + 3 Elettrici</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">Cilindrata</span>
                                    <span class="font-semibold">3990 cc</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">Trasmissione</span>
                                    <span class="font-semibold">8 Rapporti F1</span>
                                </div>
                                <div class="spec-item">
                                    <span style="color: #a59173;">Posti</span>
                                    <span class="font-semibold">2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Distance Selection -->
                <div class="glass-card p-8 animate-fade-in">
                    <h3 class="text-2xl font-bold mb-6">Scegli il Tuo Percorso</h3>
                    <div class="grid md:grid-cols-3 gap-4" id="distanceOptions">
                        <div class="distance-option" data-km="10" data-price="890">
                            <div class="text-2xl font-bold gradient-text mb-2">10 km</div>
                            <div class="text-xl font-semibold mb-1">€890</div>
                            <div class="text-sm" style="color: #a59173;">Esperienza rapida</div>
                        </div>
                        <div class="distance-option" data-km="20" data-price="1290">
                            <div class="text-2xl font-bold gradient-text mb-2">20 km</div>
                            <div class="text-xl font-semibold mb-1">€1.290</div>
                            <div class="text-sm" style="color: #a59173;">Più popolare</div>
                        </div>
                        <div class="distance-option" data-km="30" data-price="1690">
                            <div class="text-2xl font-bold gradient-text mb-2">30 km</div>
                            <div class="text-xl font-semibold mb-1">€1.690</div>
                            <div class="text-sm" style="color: #a59173;">Esperienza completa</div>
                        </div>
                        <div class="distance-option" data-km="60" data-price="2990">
                            <div class="text-2xl font-bold gradient-text mb-2">60 km</div>
                            <div class="text-xl font-semibold mb-1">€2.990</div>
                            <div class="text-sm" style="color: #a59173;">Tour esteso</div>
                        </div>
                        <div class="distance-option" data-km="70" data-price="3490">
                            <div class="text-2xl font-bold gradient-text mb-2">70 km</div>
                            <div class="text-xl font-semibold mb-1">€3.490</div>
                            <div class="text-sm" style="color: #a59173;">Avventura lunga</div>
                        </div>
                        <div class="distance-option" data-km="120" data-price="5990">
                            <div class="text-2xl font-bold gradient-text mb-2">120 km</div>
                            <div class="text-xl font-semibold mb-1">€5.990</div>
                            <div class="text-sm" style="color: #a59173;">Esperienza definitiva</div>
                        </div>
                    </div>
                </div>

                <!-- Second Car Option -->
                <div class="glass-card p-8 animate-fade-in">
                    <h3 class="text-2xl font-bold mb-4">Aggiungi Una Seconda Supercar</h3>
                    <p style="color: #c9a891;" class="mb-6">Vivi un'esperienza ancora più straordinaria combinando due vetture iconiche</p>
                    
                    <label class="checkbox-container">
                        <input type="checkbox" id="secondCarCheckbox">
                        <div>
                            <div class="font-semibold mb-1">Aggiungi Lamborghini Huracán EVO</div>
                            <div class="text-sm" style="color: #a59173;">€1.490 aggiuntivi - Include servizi fotografici e video</div>
                        </div>
                    </label>

                    <div id="extraServices" class="mt-6 space-y-4 hidden">
                        <h4 class="font-semibold text-lg mb-3 gradient-text">Servizi Aggiuntivi Disponibili</h4>
                        
                        <label class="checkbox-container">
                            <input type="checkbox" class="extra-service" data-price="290" data-service="photo">
                            <div>
                                <div class="font-semibold mb-1">Servizio Fotografico Professionale</div>
                                <div class="text-sm" style="color: #a59173;">+€290 - Su una vettura a scelta</div>
                            </div>
                        </label>

                        <label class="checkbox-container">
                            <input type="checkbox" class="extra-service" data-price="490" data-service="video-hd">
                            <div>
                                <div class="font-semibold mb-1">Video HD Professionale</div>
                                <div class="text-sm" style="color: #a59173;">+€490 - Disponibile su entrambe le vetture</div>
                            </div>
                        </label>

                        <label class="checkbox-container">
                            <input type="checkbox" class="extra-service" data-price="690" data-service="video-360">
                            <div>
                                <div class="font-semibold mb-1">Video 360° Immersivo</div>
                                <div class="text-sm" style="color: #a59173;">+€690 - Su una vettura (marchi diversi)</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Date and Time -->
                <div class="glass-card p-8 animate-fade-in">
                    <h3 class="text-2xl font-bold mb-6">Data e Orario</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="date-picker-container">
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Data</label>
                            <div style="position: relative;">
                                <input type="text" id="bookingDate" class="date-picker-input" placeholder="Seleziona data" readonly required>
                                <svg class="date-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            <!-- calendar is now rendered/positioned via JS into body -->
                            <p class="text-xs mt-2" style="color: #a59173;">Prenotazione da 48-72 ore prima, fino a 6 mesi</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Orario</label>
                            <select id="bookingTime" required>
                                <option value="">Seleziona orario</option>
                                <option value="09:00">09:00</option>
                                <option value="10:00">10:00</option>
                                <option value="11:00">11:00</option>
                                <option value="14:00">14:00</option>
                                <option value="15:00">15:00</option>
                                <option value="16:00">16:00</option>
                                <option value="17:00">17:00</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <div class="glass-card p-8 animate-fade-in">
                    <h3 class="text-2xl font-bold mb-6">I Tuoi Dati</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Nome</label>
                            <input type="text" placeholder="Il tuo nome" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Cognome</label>
                            <input type="text" placeholder="Il tuo cognome" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Email</label>
                            <input type="email" placeholder="tua@email.com" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Telefono</label>
                            <input type="tel" placeholder="+39 123 456 7890" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium mb-2" style="color: #c9a891;">Note Aggiuntive (opzionale)</label>
                            <textarea rows="3" placeholder="Hai richieste particolari?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Terms -->
                <div class="glass-card p-6 animate-fade-in">
                    <label class="checkbox-container">
                        <input type="checkbox" id="termsCheckbox" required>
                        <div class="text-sm" style="color: #c9a891;">
                            Accetto i <a href="#" class="text-[#d4af37] hover:underline">termini e condizioni</a> e la 
                            <a href="#" class="text-[#d4af37] hover:underline">politica sulla privacy</a>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Sidebar - Price Summary -->
            <div class="lg:col-span-1 sidebar"> <!-- <-- wrapper reso sticky -->
                <div class="glass-card p-8 price-summary animate-fade-in">
                    <h3 class="text-2xl font-bold mb-6 gradient-text">Riepilogo</h3>
                    
                    <div class="space-y-4 mb-6 pb-6 border-b" style="border-color: rgba(80, 60, 45, 0.3);">
                        <div class="flex justify-between">
                            <span style="color: #c9a891;">Ferrari SF90 Stradale</span>
                            <span class="font-semibold" id="basePrice">€0</span>
                        </div>
                        <div class="flex justify-between hidden" id="secondCarPrice">
                            <span style="color: #c9a891;">Lamborghini Huracán</span>
                            <span class="font-semibold">€1.490</span>
                        </div>
                        <div id="extraServicesPrice" class="space-y-2"></div>
                    </div>

                    <div class="space-y-3 mb-6">
                        <div class="flex items-center gap-2 text-sm" style="color: #c9a891;">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Assicurazione completa
                        </div>
                        <div class="flex items-center gap-2 text-sm" style="color: #c9a891;">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Nessuna cauzione richiesta
                        </div>
                        <div class="flex items-center gap-2 text-sm" style="color: #c9a891;">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Cambio data gratuito
                        </div>
                        <div class="flex items-center gap-2 text-sm" style="color: #c9a891;">
                            <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Rimborso fino a 48h prima
                        </div>
                    </div>

                    <div class="p-4 rounded-lg mb-6" style="background: linear-gradient(to right, rgba(212, 175, 55, 0.12), transparent);">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-semibold">Totale</span>
                            <span class="text-3xl font-bold gradient-text" id="totalPrice">€0</span>
                        </div>
                    </div>

                    <button class="btn-primary w-full" onclick="confirmBooking()">
                        Conferma Prenotazione
                    </button>

                    <p class="text-xs text-center mt-4" style="color: #a59173;">
                        Prenotazione sicura e protetta
                    </p>
                </div>

                <!-- Policies -->
                <div class="glass-card p-6 mt-6 animate-fade-in policies-card">
                    <h4 class="font-semibold mb-4 gradient-text">Politiche</h4>
                    <div class="space-y-3 text-sm" style="color: #c9a891;">
                        <div>
                            <strong style="color: #f5f5f0;">Rimborso:</strong> Rimborso completo fino a 48 ore prima della prenotazione.
                        </div>
                        <div>
                            <strong style="color: #f5f5f0;">Annullamento:</strong> Annullamento gratuito fino a 24 ore prima. Oltre tale termine, verrà trattenuto il 50% dell'importo.
                        </div>
                        <div>
                            <strong style="color: #f5f5f0;">Cambio Data:</strong> Modifica gratuita della data fino a 72 ore prima dell'esperienza.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let bookingData = {
            distance: null,
            basePrice: 0,
            secondCar: false,
            extraServices: [],
            total: 0,
            selectedDate: null
        };

        // Set min and max dates
        const today = new Date();
        const minDate = new Date(today);
        minDate.setDate(minDate.getDate() + 3); // 72 hours from now
        const maxDate = new Date(today);
        maxDate.setMonth(maxDate.getMonth() + 6);

        // Custom Calendar
        let currentMonth = new Date();
        const dateInput = document.getElementById('bookingDate');
        // We create a calendar element that will be appended to body when opened
        const calendar = document.createElement('div');
        calendar.id = 'customCalendar';
        calendar.className = 'custom-calendar';
        calendar.style.display = 'none';
        document.body.appendChild(calendar); // keep it at body level so it overlays everything

        function positionCalendar() {
            const rect = dateInput.getBoundingClientRect();
            const left = rect.left + window.scrollX;
            const top = rect.bottom + window.scrollY + 8;
            calendar.style.left = left + 'px';
            calendar.style.top = top + 'px';
            // make calendar at least as wide as input
            calendar.style.minWidth = rect.width + 'px';
            // optional: cap max-width
            calendar.style.maxWidth = '480px';
        }

        dateInput.addEventListener('click', function(e) {
            e.stopPropagation();
            // toggle
            calendar.style.display = (calendar.style.display === 'none' || !calendar.style.display) ? 'block' : 'none';
            renderCalendar();
            positionCalendar();
        });

        // Close calendar when clicking outside
        document.addEventListener('click', function(e) {
            if (!calendar.contains(e.target) && e.target !== dateInput) {
                calendar.style.display = 'none';
            }
        });

        // reposition on scroll/resize while open
        window.addEventListener('resize', () => {
            if (calendar.style.display === 'block') positionCalendar();
        });
        window.addEventListener('scroll', () => {
            if (calendar.style.display === 'block') positionCalendar();
        }, true);

        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno',
                              'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            
            let html = `
                <div class="calendar-header">
                    <button class="calendar-nav" onclick="previousMonth(event)">◄</button>
                    <div class="text-lg font-bold gradient-text">${monthNames[month]} ${year}</div>
                    <button class="calendar-nav" onclick="nextMonth(event)">►</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">Dom</div>
                    <div class="calendar-day-header">Lun</div>
                    <div class="calendar-day-header">Mar</div>
                    <div class="calendar-day-header">Mer</div>
                    <div class="calendar-day-header">Gio</div>
                    <div class="calendar-day-header">Ven</div>
                    <div class="calendar-day-header">Sab</div>
            `;

            // Empty cells before first day
            for (let i = 0; i < startingDayOfWeek; i++) {
                html += '<div class="calendar-day empty"></div>';
            }

            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const isDisabled = currentDate < minDate || currentDate > maxDate;
                const isSelected = bookingData.selectedDate && 
                                 currentDate.toDateString() === bookingData.selectedDate.toDateString();
                
                const classes = ['calendar-day'];
                if (isDisabled) classes.push('disabled');
                if (isSelected) classes.push('selected');

                html += `<div class="${classes.join(' ')}" 
                             onclick="selectDate(${year}, ${month}, ${day}, ${isDisabled})">${day}</div>`;
            }

            html += '</div>';
            calendar.innerHTML = html;
        }

        function previousMonth(e) {
            e.preventDefault();
            e.stopPropagation();
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
            positionCalendar();
        }

        function nextMonth(e) {
            e.preventDefault();
            e.stopPropagation();
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
            positionCalendar();
        }

        function selectDate(year, month, day, isDisabled) {
            if (isDisabled) return;
            
            bookingData.selectedDate = new Date(year, month, day);
            const formatted = bookingData.selectedDate.toLocaleDateString('it-IT', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            dateInput.value = formatted;
            calendar.style.display = 'none';
            renderCalendar();
        }

        // Distance selection
        document.querySelectorAll('.distance-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.distance-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                
                bookingData.distance = this.dataset.km;
                bookingData.basePrice = parseInt(this.dataset.price);
                updatePriceSummary();
            });
        });

        // auto-select first distance option on load so price is not €0
        (function selectDefaultDistance() {
            const firstOption = document.querySelector('.distance-option');
            if (firstOption) {
                firstOption.classList.add('selected');
                bookingData.distance = firstOption.dataset.km;
                bookingData.basePrice = parseInt(firstOption.dataset.price);
                updatePriceSummary();
            }
        })();

        // Second car checkbox
        document.getElementById('secondCarCheckbox').addEventListener('change', function() {
            bookingData.secondCar = this.checked;
            document.getElementById('extraServices').classList.toggle('hidden', !this.checked);
            document.getElementById('secondCarPrice').classList.toggle('hidden', !this.checked);
            
            if (!this.checked) {
                document.querySelectorAll('.extra-service').forEach(cb => cb.checked = false);
                bookingData.extraServices = [];
            }
            
            updatePriceSummary();
        });

        // Extra services
        document.querySelectorAll('.extra-service').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const price = parseInt(this.dataset.price);
                const service = this.dataset.service;
                
                if (this.checked) {
                    bookingData.extraServices.push({ service, price });
                } else {
                    bookingData.extraServices = bookingData.extraServices.filter(s => s.service !== service);
                }
                
                updatePriceSummary();
            });
        });

        function updatePriceSummary() {
            let total = bookingData.basePrice;
            
            document.getElementById('basePrice').textContent = `€${bookingData.basePrice.toLocaleString()}`;
            
            if (bookingData.secondCar) {
                total += 1490;
            }
            
            const extraServicesDiv = document.getElementById('extraServicesPrice');
            extraServicesDiv.innerHTML = '';
            
            bookingData.extraServices.forEach(service => {
                total += service.price;
                const serviceNames = {
                    'photo': 'Servizio Fotografico',
                    'video-hd': 'Video HD',
                    'video-360': 'Video 360°'
                };
                
                const div = document.createElement('div');
                div.className = 'flex justify-between';
                div.innerHTML = `
                    <span class="text-sm" style="color: #c9a891;">${serviceNames[service.service]}</span>
                    <span class="font-semibold text-sm">€${service.price}</span>
                `;
                extraServicesDiv.appendChild(div);
            });
            
            bookingData.total = total;
            document.getElementById('totalPrice').textContent = `€${total.toLocaleString()}`;
        }

        function confirmBooking() {
            if (!bookingData.distance) {
                alert('Seleziona un percorso prima di procedere');
                return;
            }
            
            const date = bookingData.selectedDate;
            const time = document.getElementById('bookingTime').value;
            const terms = document.getElementById('termsCheckbox').checked;
            
            if (!date || !time) {
                alert('Seleziona data e orario');
                return;
            }
            
            if (!terms) {
                alert('Accetta i termini e condizioni per procedere');
                return;
            }
            
            const formatted = date.toLocaleDateString('it-IT', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            alert(`Prenotazione confermata!\n\nRiepilogo:\n- Percorso: ${bookingData.distance} km\n- Data: ${formatted} alle ${time}\n- Totale: €${bookingData.total.toLocaleString()}\n\nRiceverai una conferma via email.`);
        }

        // Animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        document.querySelectorAll('.animate-fade-in').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'all 0.6s ease';
            observer.observe(el);
        });
    </script>
</body>
</html>
